<!-- Header -->
<app-header></app-header>

<div class="title-bar">
  <ion-button class="back-button" (click)="goBack()" fill="clear" size="small">
    <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
  </ion-button>
  <h3>Detail Transaksi</h3>
</div>

<ion-content class="transaction-details-page" fullscreen>
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="ion-text-center ion-padding">
    <ion-spinner name="crescent" style="transform: scale(1.5); margin-top: 50%;"></ion-spinner>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !transactionDetail" class="empty-state">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>Detail transaksi tidak dapat ditemukan.</p>
  </div>
  
  <div *ngIf="!isLoading && transactionDetail" class="content-section">
    <!-- Transaction Card -->
    <div class="transaction-card">
      <h4>{{ getPageTitle() }}</h4>

      <div class="transaction-details">
        
        <div *ngIf="transactionDetail.loan" class="detail-row">
          <span class="label">Jumlah Pinjaman Awal:</span>
          <span class="value">{{ transactionDetail.loan?.jumlah_pinjaman | currency:'IDR':'Rp':'1.0-0' }}</span>
        </div>

        <div class="detail-row">
          <span class="label">Nominal Transaksi:</span>
          <span class="value">{{ getNominalValue() | currency:'IDR':'Rp':'1.0-0' }}</span>
        </div>

        <div class="detail-row row-tanggal">
          <span class="label">Tanggal Transaksi:</span>
          <div class="value">
            <span class="date">{{ transactionDetail.tgl_transaksi | date:'d MMMM y' }}</span>
            <span class="time">{{ transactionDetail.created_at | date:'HH:mm:ss' }}</span>
          </div>
        </div>
        
        <div *ngIf="transactionDetail.cicilan_ke" class="detail-row">
          <span class="label">Angsuran Ke:</span>
          <span class="value">Ke-{{ transactionDetail.cicilan_ke }}</span>
        </div>

        <div *ngIf="transactionDetail.sisa_hutang" class="detail-row">
          <span class="label">Sisa Hutang:</span>
          <span class="value">{{ transactionDetail.sisa_hutang | currency:'IDR':'Rp':'1.0-0' }}</span>
        </div>

        <div *ngIf="transactionDetail.status" class="detail-row">
          <span class="label">Status Pembayaran:</span>
          <span class="status-badge">{{ transactionDetail.status }}</span>
        </div>

        <div class="detail-row">
          <span class="label">Lokasi Transaksi:</span>
          <ion-button class="location-btn" size="small" shape="round" (click)="openMap()" [disabled]="!transactionDetail.location?.latitude">
            <ion-icon name="location-outline" slot="start"></ion-icon>
            Lihat di Maps
          </ion-button>
        </div>
      </div>
    </div>

    <!-- PERBAIKAN: Tombol unduh sekarang selalu tampil -->
    <div class="download-section">
      <ion-button class="download-btn" expand="block" shape="round" (click)="downloadSlip()">
        <ion-icon name="download-outline" slot="start"></ion-icon>
        Unduh Slip Pembayaran
      </ion-button>
    </div>
  </div>
</ion-content>
